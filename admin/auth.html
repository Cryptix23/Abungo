<!DOCTYPE html>
<html>
    <head>
        <title>Abungo Admin Dashboard</title>
        <style>
            *,*:before,*:after {
                box-sizing:border-box;
                font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;
                margin:0;
                padding:0;
            }
            
            *:focus {
                outline:none;
            }
            
            html,body {
                margin:0;
                padding:0;
                height:100%;
                width:100%;
                overflow:hidden;
                background-color:black;
            }
            
            #command, li {
                font-family:Menlo,Consolas,"Courier New",monospace;
                display:block;
                width:100%;
                border:none;
                font-size:15px;
                color:#0f0;
            }
            
            #command {
                padding:20px 50px;
                background-color:transparent;
                position:fixed;
                left:0;
                bottom:0;
                height:58px;
            }
            
            #log {
                list-style:none;
                padding:20px 50px;
                height:calc(100% - 58px);
                overflow:auto;
                padding-bottom:0;
            }
            
            #log li {
                word-wrap:break-word;
            }
        </style>
    </head>
    <body>
        <ul id="log"></ul>
        <input id="command">
            
        <script src="/socket.io/socket.io.js"></script>
        
        <script>
            var socket = io();
            
            var $ = function(selector) {return document.querySelector(selector)};
            var $$ = function(selector) {return document.querySelectorAll(selector)};
            
            HTMLElement.prototype.append = function(node) {
                this.appendChild(node);
                this.scrollTop = this.scrollHeight;
            }
            
            $("#command").onkeydown = function(e){
                if (e.which == 13) {
                    if (this.value == "stop") {
                        socket.emit("admin stop");
                    } else if (this.value == "brainwash") {
                        socket.emit("admin brainwash");
                    } else if (this.value == "list") {
                        socket.emit("admin list");
                    } else if (this.value == "disconall") {
                        socket.emit("admin disconall");
                    } else if (this.value.indexOf("say ") == 0) {
                        var text = this.value.substring("say ".length);
                        socket.emit("admin chat",{
                            text: text
                        });
                    } else if (this.value.indexOf("kick ") == 0) {
                        var room = this.value.substring("kick ".length, this.value.indexOf(":"));
                        var kickee = this.value.substring(this.value.indexOf(":") + 1);
                        socket.emit("kick",{
                            nick: kickee,
                            room: room,
                            reason: "King Jimmy has spoken"
                        });
                    } else {
                        var liNode = document.createElement("li");
                        liNode.textContent = "Unknown command '"+this.value+"'";
                        $("#log").append(liNode);
                    }
                    this.value = "";
                }
            }
            
            window.onload = window.onfocus = window.onclick = function(){
                $("#command").focus();
            }
            
            socket.on("admin list",function(list){
                var listStr = JSON.stringify(list);
                var liNode = document.createElement("li");
                liNode.textContent = listStr;
                $("#log").append(liNode);
            });
            
            socket.on("admin log",function(str){
                var liNode = document.createElement("li");
                liNode.textContent = str;
                $("#log").append(liNode);
            });
            
            socket.emit("i am admin");
        </script>
    </body>
</html>